
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>generate_utils &#8212; CSTrack 05-08-2021 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for generate_utils</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">from</span> <span class="nn">wordcloud</span> <span class="kn">import</span> <span class="n">WordCloud</span><span class="p">,</span> <span class="n">STOPWORDS</span><span class="p">,</span> <span class="n">ImageColorGenerator</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">vaderSentiment.vaderSentiment</span> <span class="kn">import</span> <span class="n">SentimentIntensityAnalyzer</span>

<span class="c1"># stop_words para emplear en filtrados:</span>

<span class="n">stop_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">]</span>

<span class="c1"># Función para grafica de barras:</span>

<div class="viewcode-block" id="plotbarchart"><a class="viewcode-back" href="../generate_utils.html#generate_utils.plotbarchart">[docs]</a><span class="k">def</span> <span class="nf">plotbarchart</span><span class="p">(</span><span class="n">numberbars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">[:</span><span class="n">numberbars</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="n">y</span><span class="p">[:</span><span class="n">numberbars</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightsteelblue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<span class="c1"># Función para obtener los subgrafos con NetworkX:</span>

<div class="viewcode-block" id="get_subgraphs"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_subgraphs">[docs]</a><span class="k">def</span> <span class="nf">get_subgraphs</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
    <span class="n">components</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">graph</span><span class="p">))</span>
    <span class="n">list_subgraphs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
        <span class="n">list_subgraphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">component</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">list_subgraphs</span></div>

<span class="c1"># Función para convertir a direct graph los subgrafos:</span>

<div class="viewcode-block" id="make_weightedDiGraph"><a class="viewcode-back" href="../generate_utils.html#generate_utils.make_weightedDiGraph">[docs]</a><span class="k">def</span> <span class="nf">make_weightedDiGraph</span><span class="p">(</span><span class="n">ejes</span><span class="p">):</span>
    <span class="n">edges_tupla</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ejes</span><span class="p">]</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">v</span><span class="p">})</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">edges_tupla</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">G</span></div>

<div class="viewcode-block" id="direct_subgraphs"><a class="viewcode-back" href="../generate_utils.html#generate_utils.direct_subgraphs">[docs]</a><span class="k">def</span> <span class="nf">direct_subgraphs</span><span class="p">(</span><span class="n">subgraphs</span><span class="p">):</span>
    <span class="n">list_directsubgraphs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subgraphs</span><span class="p">)):</span>
        <span class="n">list_directsubgraphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subgraphs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">to_directed</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">list_directsubgraphs</span></div>

<span class="c1"># Función para filtrar usando el topic que nos interese:</span>

<div class="viewcode-block" id="filter_by_topic"><a class="viewcode-back" href="../generate_utils.html#generate_utils.filter_by_topic">[docs]</a><span class="k">def</span> <span class="nf">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">keywords</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keywords</span><span class="p">),</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">stopwords</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stopwords</span><span class="p">),</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;learning.csv&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span></div>

<span class="c1"># Función para filtrar por interés:</span>

<div class="viewcode-block" id="filter_by_interest"><a class="viewcode-back" href="../generate_utils.html#generate_utils.filter_by_interest">[docs]</a><span class="k">def</span> <span class="nf">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">interest</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Marca&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">interest</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df</span></div>

<span class="c1"># Calcular grafo de citas:</span>

<div class="viewcode-block" id="get_cites"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_cites">[docs]</a><span class="k">def</span> <span class="nf">get_cites</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">78202</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">dfMentions</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dfMentions</span> <span class="o">=</span> <span class="n">dfMentions</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">dfEliminarRTs</span> <span class="o">=</span> <span class="n">dfMentions</span><span class="p">[</span><span class="n">dfMentions</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">)]</span>
    <span class="n">dfMentions</span> <span class="o">=</span> <span class="n">dfMentions</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">dfEliminarRTs</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">mentionsSubset</span> <span class="o">=</span> <span class="n">dfMentions</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>
    <span class="n">mentionsList</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mentionsSubset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">mentionsList</span></div>



<span class="c1"># Calcular grafos de RT:</span>

<div class="viewcode-block" id="get_retweets"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_retweets">[docs]</a><span class="k">def</span> <span class="nf">get_retweets</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">dfRT</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">,</span> <span class="s1">&#39;Fecha&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Se copia a un dataframe de trabajo</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dfRT</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>  <span class="c1"># Se seleccionan sólo las filas con RT</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>  <span class="c1"># Se descarta la fecha</span>
    <span class="n">retweetEdges</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span>  <span class="c1"># Se transforma en una lista</span>
    <span class="k">return</span> <span class="n">retweetEdges</span></div>

<span class="c1"># Función para extraer edges de rts y citas:</span>

<div class="viewcode-block" id="get_edges"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_edges">[docs]</a><span class="k">def</span> <span class="nf">get_edges</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;@(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">reg</span><span class="p">:</span>
            <span class="n">matchRT</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Se extrae la primera mención que hace referencia a la cuenta retuiteada</span>
            <span class="c1"># row[1] = hashlib.md5(match.encode()).hexdigest()</span>
            <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchRT</span>  <span class="c1"># Convierte el nombre de la cuenta en hash y lo asigna al elemento</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">edges</span></div>


<span class="c1">## Código para crear gráfica de barras  de Hashtags más usados en los retuits:</span>
<span class="c1"># Seleccionamos las filas solo con RTs y creamos al final una lista que contiene todos los textos</span>

<div class="viewcode-block" id="get_hashtagsRT"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_hashtagsRT">[docs]</a><span class="k">def</span> <span class="nf">get_hashtagsRT</span><span class="p">(</span><span class="n">df_loaded</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df_loaded</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">dfHashtagsRT</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dfHashtagsRT</span> <span class="o">=</span> <span class="n">dfHashtagsRT</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">dfHashtagsRT</span> <span class="o">=</span> <span class="n">dfHashtagsRT</span><span class="p">[</span><span class="n">dfHashtagsRT</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">)]</span>
    <span class="n">listHashtagsRT</span> <span class="o">=</span> <span class="n">dfHashtagsRT</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">listHashtagsRT</span></div>

<span class="c1"># Obtenemos los hashtags usados en esos textos</span>

<div class="viewcode-block" id="get_edgesHashRT"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_edgesHashRT">[docs]</a><span class="k">def</span> <span class="nf">get_edgesHashRT</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashtag</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">edges</span></div>

<span class="c1"># Organizamos los hashtags en orden de más usados a menos usados y creamos una lista con la cantidad de veces que aparecen</span>
<div class="viewcode-block" id="prepare_hashtags"><a class="viewcode-back" href="../generate_utils.html#generate_utils.prepare_hashtags">[docs]</a><span class="k">def</span> <span class="nf">prepare_hashtags</span><span class="p">(</span><span class="n">list_h</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is the list&quot;</span><span class="p">)</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">]</span>
    <span class="n">list_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_h</span><span class="p">]</span>
    <span class="n">list_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">list_x</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stop_words</span><span class="p">]</span>
    <span class="n">list_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">list_x</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">list_x</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">((</span><span class="nb">zip</span><span class="p">(</span><span class="n">list_x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">list_x</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">un</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">unzipped</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">list_x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">unzipped</span><span class="p">:</span>
        <span class="n">un</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">v1</span><span class="p">))</span>
    <span class="sd">&quot;&quot;&quot;print(&quot;THIS IS UN&quot;)</span>
<span class="sd">    print(un)&quot;&quot;&quot;</span>
    <span class="n">sortedNumberHashtags</span><span class="p">,</span> <span class="n">sortedHashtagsRT</span> <span class="o">=</span> <span class="n">un</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sortedNumberHashtags</span><span class="p">,</span> <span class="n">sortedHashtagsRT</span></div>


<span class="c1"># Código para calcular el grafo de Hashtags dentro de los retuits</span>

<div class="viewcode-block" id="get_hashtagsRT2"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_hashtagsRT2">[docs]</a><span class="k">def</span> <span class="nf">get_hashtagsRT2</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">dfHashtagsRT</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">dfHashtagsRT</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dfHashtagsRT</span> <span class="o">=</span> <span class="n">dfHashtagsRT</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">listHashtagsRT</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dfHashtagsRT</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">listHashtagsRT</span></div>


<div class="viewcode-block" id="get_edgesHashRT2"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_edgesHashRT2">[docs]</a><span class="k">def</span> <span class="nf">get_edgesHashRT2</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">matchHashRT</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchHashRT</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">edges</span></div>

<span class="c1"># Combinación de los ejes de RTs y Citas:</span>

<div class="viewcode-block" id="combined_edges"><a class="viewcode-back" href="../generate_utils.html#generate_utils.combined_edges">[docs]</a><span class="k">def</span> <span class="nf">combined_edges</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="n">combined_edges</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">combined_edges</span></div>

<span class="c1">## Código para calcular grafo de hashtags relacionados fuera de RTs. Este grafo opretende mostrar que</span>
<span class="c1">##hashtags estan interrlacionados entre si.</span>

<div class="viewcode-block" id="get_hashtagsmain"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_hashtagsmain">[docs]</a><span class="k">def</span> <span class="nf">get_hashtagsmain</span><span class="p">(</span><span class="n">df_t</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df_t</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">dfMainHashtags</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dfMainHashtags</span> <span class="o">=</span> <span class="n">dfMainHashtags</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">dfMainHashtags</span><span class="p">[</span><span class="n">dfMainHashtags</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">)]</span>
    <span class="n">dfMainHashtags</span> <span class="o">=</span> <span class="n">dfMainHashtags</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">dfMainHashtags</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span>
    <span class="n">listMainHashtags</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">listMainHashtags</span></div>

<div class="viewcode-block" id="mainHashtags"><a class="viewcode-back" href="../generate_utils.html#generate_utils.mainHashtags">[docs]</a><span class="k">def</span> <span class="nf">mainHashtags</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">]</span>
    <span class="n">mainHashtags</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">aristasHashtags</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">match</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stop_words</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">hashtag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
        <span class="n">mainHashtags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashtag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">|</span> <span class="p">(</span><span class="n">length</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">nextHashtags</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">nextHashtags</span> <span class="ow">in</span> <span class="n">nextHashtags</span><span class="p">:</span>
                <span class="n">aristasHashtags</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">hashtag</span><span class="p">,</span><span class="n">nextHashtags</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">aristasHashtags</span></div>

<div class="viewcode-block" id="prepare_hashtags2"><a class="viewcode-back" href="../generate_utils.html#generate_utils.prepare_hashtags2">[docs]</a><span class="k">def</span> <span class="nf">prepare_hashtags2</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="n">mainHashtags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mainHashtags</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">((</span><span class="nb">zip</span><span class="p">(</span><span class="n">mainHashtags</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mainHashtags</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sortedNumberHashtags</span><span class="p">,</span> <span class="n">sortedMainHashtags</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">mainHashtags</span><span class="p">)</span>
    <span class="n">hashtagsOnce</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">mainHashtags</span> <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">hashtagsFinales</span> <span class="o">=</span> <span class="p">[</span><span class="n">hashtag</span> <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="nb">list</span> <span class="k">if</span> <span class="n">hashtag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hashtagsOnce</span><span class="p">]</span>
    <span class="n">hashtagsFinales</span> <span class="o">=</span> <span class="p">[</span><span class="n">hashtag</span> <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">hashtagsFinales</span> <span class="k">if</span> <span class="n">hashtag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hashtagsOnce</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">hashtagsFinales</span></div>

<span class="c1"># Creación de grafo hashtags más utilizados (relacionado con usuario):</span>

<div class="viewcode-block" id="get_hashtagsmain2"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_hashtagsmain2">[docs]</a><span class="k">def</span> <span class="nf">get_hashtagsmain2</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">78202</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">dfMainHashtags</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dfMainHashtags</span> <span class="o">=</span> <span class="n">dfMainHashtags</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">dfMainHashtags</span><span class="p">[</span><span class="n">dfMainHashtags</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">)]</span>
    <span class="n">dfMainHashtags</span> <span class="o">=</span> <span class="n">dfMainHashtags</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">dfMainHashtags</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span><span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>
    <span class="n">listMainHashtags</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">listMainHashtags</span></div>

<div class="viewcode-block" id="get_edgesmain2"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_edgesmain2">[docs]</a><span class="k">def</span> <span class="nf">get_edgesmain2</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">,</span><span class="s1">&#39;CitizenScience&#39;</span><span class="p">]]</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">matchhash</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchhash</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">edges</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">stop_words</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">edges</span></div>

<span class="c1"># Creación de gráfica hashtags más usados fuera de RTs (usar get_hashtagsmain())</span>

<div class="viewcode-block" id="get_edgesMain"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_edgesMain">[docs]</a><span class="k">def</span> <span class="nf">get_edgesMain</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashtag</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">edges</span></div>

<span class="c1"># Hashtags del Bot:</span>
<span class="n">botwords</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;airpollution&#39;</span><span class="p">,</span> <span class="s1">&#39;luftdaten&#39;</span><span class="p">,</span> <span class="s1">&#39;fijnstof&#39;</span><span class="p">,</span> <span class="s1">&#39;waalre&#39;</span><span class="p">,</span> <span class="s1">&#39;pm2&#39;</span><span class="p">,</span> <span class="s1">&#39;pm10&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="prepare_hashtagsmain"><a class="viewcode-back" href="../generate_utils.html#generate_utils.prepare_hashtagsmain">[docs]</a><span class="k">def</span> <span class="nf">prepare_hashtagsmain</span><span class="p">(</span><span class="n">list_h</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">list_h</span><span class="p">)</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">,</span> <span class="s1">&#39;machinelearning&#39;</span><span class="p">,</span> <span class="s1">&#39;ml&#39;</span><span class="p">,</span> <span class="s1">&#39;ai&#39;</span><span class="p">,</span> <span class="s1">&#39;deeplearning&#39;</span> <span class="p">]</span>
    <span class="k">if</span> <span class="n">stopwords</span><span class="p">:</span>
        <span class="n">stop_words</span> <span class="o">=</span> <span class="n">stop_words</span> <span class="o">+</span> <span class="n">stopwords</span>
    <span class="n">list_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_h</span><span class="p">]</span>
    <span class="n">list_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">list_x</span> <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stop_words</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">list_x</span><span class="p">)</span>
    <span class="n">mainHashtags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">list_x</span><span class="p">,</span><span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mainHashtags</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">((</span><span class="nb">zip</span><span class="p">(</span><span class="n">mainHashtags</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mainHashtags</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">un</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">unzipped</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">mainHashtags</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">unzipped</span><span class="p">:</span>
        <span class="n">un</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">v1</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;THIS IS UN&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">un</span><span class="p">)</span>
    <span class="n">sortedNumberHashtags</span><span class="p">,</span> <span class="n">sortedMainHashtags</span> <span class="o">=</span> <span class="n">un</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sortedNumberHashtags</span><span class="p">,</span><span class="n">sortedMainHashtags</span></div>


<div class="viewcode-block" id="get_prop_type"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_prop_type">[docs]</a><span class="k">def</span> <span class="nf">get_prop_type</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs typing and value conversion for the graph_tool PropertyMap class.</span>
<span class="sd">    If a key is provided, it also ensures the key is in a format that can be</span>
<span class="sd">    used with the PropertyMap. Returns a tuple, (type name, value, key)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Deal with the value</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="n">tname</span> <span class="o">=</span> <span class="s1">&#39;bool&#39;</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">tname</span> <span class="o">=</span> <span class="s1">&#39;float&#39;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="n">tname</span> <span class="o">=</span> <span class="s1">&#39;float&#39;</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">tname</span> <span class="o">=</span> <span class="s1">&#39;object&#39;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">tname</span> <span class="o">=</span> <span class="s1">&#39;string&#39;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tname</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">key</span></div>


<div class="viewcode-block" id="nx2gt"><a class="viewcode-back" href="../generate_utils.html#generate_utils.nx2gt">[docs]</a><span class="k">def</span> <span class="nf">nx2gt</span><span class="p">(</span><span class="n">nxG</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a networkx graph to a graph-tool graph.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Phase 0: Create a directed or undirected graph-tool Graph</span>
    <span class="n">gtG</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">directed</span><span class="o">=</span><span class="n">nxG</span><span class="o">.</span><span class="n">is_directed</span><span class="p">())</span>

    <span class="c1"># Add the Graph properties as &quot;internal properties&quot;</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">nxG</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Convert the value and key into a type for graph-tool</span>
        <span class="n">tname</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">get_prop_type</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

        <span class="n">prop</span> <span class="o">=</span> <span class="n">gtG</span><span class="o">.</span><span class="n">new_graph_property</span><span class="p">(</span><span class="n">tname</span><span class="p">)</span>  <span class="c1"># Create the PropertyMap</span>
        <span class="n">gtG</span><span class="o">.</span><span class="n">graph_properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop</span>      <span class="c1"># Set the PropertyMap</span>
        <span class="n">gtG</span><span class="o">.</span><span class="n">graph_properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>     <span class="c1"># Set the actual value</span>

    <span class="c1"># Phase 1: Add the vertex and edge property maps</span>
    <span class="c1"># Go through all nodes and edges and add seen properties</span>
    <span class="c1"># Add the node properties first</span>
    <span class="n">nprops</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># cache keys to only add properties once</span>
    <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">nxG</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="c1"># Go through all the properties if not seen and add them.</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">nprops</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># Skip properties already added</span>

            <span class="c1"># Convert the value and key into a type for graph-tool</span>
            <span class="n">tname</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">get_prop_type</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

            <span class="n">prop</span> <span class="o">=</span> <span class="n">gtG</span><span class="o">.</span><span class="n">new_vertex_property</span><span class="p">(</span><span class="n">tname</span><span class="p">)</span>  <span class="c1"># Create the PropertyMap</span>
            <span class="n">gtG</span><span class="o">.</span><span class="n">vertex_properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop</span>      <span class="c1"># Set the PropertyMap</span>

            <span class="c1"># Add the key to the already seen properties</span>
            <span class="n">nprops</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="c1"># Also add the node id: in NetworkX a node can be any hashable type, but</span>
    <span class="c1"># in graph-tool node are defined as indices. So we capture any strings</span>
    <span class="c1"># in a special PropertyMap called &#39;id&#39; -- modify as needed!</span>
    <span class="n">gtG</span><span class="o">.</span><span class="n">vertex_properties</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gtG</span><span class="o">.</span><span class="n">new_vertex_property</span><span class="p">(</span><span class="s1">&#39;string&#39;</span><span class="p">)</span>

    <span class="c1"># Add the edge properties second</span>
    <span class="n">eprops</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># cache keys to only add properties once</span>
    <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">nxG</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="c1"># Go through all the edge properties if not seen and add them.</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">eprops</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># Skip properties already added</span>

            <span class="c1"># Convert the value and key into a type for graph-tool</span>
            <span class="n">tname</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">get_prop_type</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

            <span class="n">prop</span> <span class="o">=</span> <span class="n">gtG</span><span class="o">.</span><span class="n">new_edge_property</span><span class="p">(</span><span class="n">tname</span><span class="p">)</span>  <span class="c1"># Create the PropertyMap</span>
            <span class="n">gtG</span><span class="o">.</span><span class="n">edge_properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop</span>      <span class="c1"># Set the PropertyMap</span>

            <span class="c1"># Add the key to the already seen properties</span>
            <span class="n">eprops</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="c1"># Phase 2: Actually add all the nodes and vertices with their properties</span>
    <span class="c1"># Add the nodes</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># vertex mapping for tracking edges later</span>
    <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">nxG</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="c1"># Create the vertex and annotate for our edges later</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">gtG</span><span class="o">.</span><span class="n">add_vertex</span><span class="p">()</span>
        <span class="n">vertices</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="c1"># Set the vertex properties, not forgetting the id property</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">gtG</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>  <span class="c1"># vp is short for vertex_properties</span>

    <span class="c1"># Add the edges</span>
    <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">nxG</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="c1"># Look up the vertex structs from our vertices mapping and add edge.</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">gtG</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="n">src</span><span class="p">],</span> <span class="n">vertices</span><span class="p">[</span><span class="n">dst</span><span class="p">])</span>

        <span class="c1"># Add the edge properties</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">gtG</span><span class="o">.</span><span class="n">ep</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>  <span class="c1"># ep is short for edge_properties</span>

    <span class="c1"># Done, finally!</span>
    <span class="k">return</span> <span class="n">gtG</span></div>

<span class="c1"># Función para extraer los valores de degree,outdegree, eigenvector y betweenness y crear un csv:</span>

<div class="viewcode-block" id="get_degrees"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_degrees">[docs]</a><span class="k">def</span> <span class="nf">get_degrees</span><span class="p">(</span><span class="n">G</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">networkit</span> <span class="k">as</span> <span class="nn">nk</span>
    <span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
    <span class="n">n_g</span> <span class="o">=</span> <span class="n">nk</span><span class="o">.</span><span class="n">nxadapter</span><span class="o">.</span><span class="n">nx2nk</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
    <span class="n">idmap</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">u</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span> <span class="nb">range</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">())))</span>
    <span class="n">btwn</span> <span class="o">=</span> <span class="n">nk</span><span class="o">.</span><span class="n">centrality</span><span class="o">.</span><span class="n">Betweenness</span><span class="p">(</span><span class="n">n_g</span><span class="p">)</span>
    <span class="n">ec</span> <span class="o">=</span> <span class="n">nk</span><span class="o">.</span><span class="n">centrality</span><span class="o">.</span><span class="n">EigenvectorCentrality</span><span class="p">(</span><span class="n">n_g</span><span class="p">)</span>
    <span class="n">ec</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">btwn</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">bt_results</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">btwn</span><span class="o">.</span><span class="n">ranking</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">bt_results</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">bt_results</span><span class="p">]</span>
    <span class="n">ec_results</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ec</span><span class="o">.</span><span class="n">ranking</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">ec_results</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ec_results</span><span class="p">]</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">in_degrees</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">out_degrees</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">n_g</span><span class="o">.</span><span class="n">iterNodes</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idmap</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="n">in_degrees</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_g</span><span class="o">.</span><span class="n">degreeIn</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="n">out_degrees</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_g</span><span class="o">.</span><span class="n">degreeOut</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">names</span><span class="p">,</span> <span class="s2">&quot;InD.&quot;</span><span class="p">:</span> <span class="n">in_degrees</span><span class="p">,</span> <span class="s2">&quot;OutD.&quot;</span><span class="p">:</span> <span class="n">out_degrees</span><span class="p">,</span> <span class="s2">&quot;Eigen C.&quot;</span><span class="p">:</span> <span class="n">ec_results</span><span class="p">,</span> <span class="s2">&quot;Betweenness C&quot;</span><span class="p">:</span> <span class="n">bt_results</span><span class="p">})</span></div>

<div class="viewcode-block" id="csv_degval"><a class="viewcode-back" href="../generate_utils.html#generate_utils.csv_degval">[docs]</a><span class="k">def</span> <span class="nf">csv_degval</span><span class="p">(</span><span class="n">Digraph</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="n">list_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">outdegrees2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Digraph</span><span class="o">.</span><span class="n">out_degree</span><span class="p">())</span>
    <span class="n">indegrees</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Digraph</span><span class="o">.</span><span class="n">in_degree</span><span class="p">())</span>
    <span class="n">centrality</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">eigenvector_centrality</span><span class="p">(</span><span class="n">Digraph</span><span class="p">))</span>
    <span class="n">betweenness</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">betweenness_centrality</span><span class="p">(</span><span class="n">Digraph</span><span class="p">))</span>
    <span class="n">indegtupl</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">indegrees</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">indegtupl</span> <span class="o">=</span> <span class="n">indegtupl</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indegtupl</span><span class="p">]</span>
    <span class="n">outdegtupl</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">outdegrees2</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">centraltupl</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">centrality</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">betwentupl</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">betweenness</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="n">pos_indeg</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">indegtupl</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">rank_indeg</span> <span class="o">=</span> <span class="n">pos_indeg</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">indeg_val</span> <span class="o">=</span> <span class="n">indegtupl</span><span class="p">[</span><span class="n">pos_indeg</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pos_outdeg</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">outdegtupl</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">rank_outdeg</span> <span class="o">=</span> <span class="n">pos_outdeg</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">outdeg_val</span> <span class="o">=</span> <span class="n">outdegtupl</span><span class="p">[</span><span class="n">pos_outdeg</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pos_central</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">centraltupl</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">rank_central</span> <span class="o">=</span> <span class="n">pos_central</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">central_val</span> <span class="o">=</span> <span class="n">centraltupl</span><span class="p">[</span><span class="n">pos_central</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">central_val</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">centraltupl</span><span class="p">[</span><span class="n">pos_central</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">pos_between</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">betwentupl</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">rank_between</span> <span class="o">=</span> <span class="n">pos_between</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">between_val</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">betwentupl</span><span class="p">[</span><span class="n">pos_between</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">list_values</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">indeg_val</span><span class="p">,</span> <span class="n">rank_indeg</span><span class="p">,</span> <span class="n">outdeg_val</span><span class="p">,</span> <span class="n">rank_outdeg</span><span class="p">,</span> <span class="n">central_val</span><span class="p">,</span> <span class="n">rank_central</span><span class="p">,</span>
                        <span class="n">between_val</span><span class="p">,</span> <span class="n">rank_between</span><span class="p">))</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">list_values</span><span class="p">,</span>
                      <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Indegree&#39;</span><span class="p">,</span> <span class="s1">&#39;R.In&#39;</span><span class="p">,</span> <span class="s1">&#39;Outdegree&#39;</span><span class="p">,</span> <span class="s1">&#39;R.Out&#39;</span><span class="p">,</span> <span class="s1">&#39;Eigenvector&#39;</span><span class="p">,</span> <span class="s1">&#39;R.EI&#39;</span><span class="p">,</span> <span class="s1">&#39;Betweenness&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;R.Bet&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">df</span></div>

<span class="c1">## Funciones para obtener los elementos de la two mode:</span>

<div class="viewcode-block" id="get_twomodeRT"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_twomodeRT">[docs]</a><span class="k">def</span> <span class="nf">get_twomodeRT</span><span class="p">(</span><span class="n">full_df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">full_df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">dfRT</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dfRT</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>
    <span class="n">u</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">])</span>
    <span class="n">v</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">])</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
    <span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">bipartite</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">G</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">bipartite</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Número nodos:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10000</span><span class="p">:</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">k_core</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4000</span><span class="p">:</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">k_core</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">k_core</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">list</span><span class="p">((</span><span class="n">nx</span><span class="o">.</span><span class="n">core_number</span><span class="p">(</span><span class="n">G</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">pos</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">u</span><span class="p">)))</span>
    <span class="n">pos</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">G</span></div>
<span class="c1"># Obtención de los elementos u,v y los edges que los unen para usuario y texto en los retuits:</span>

<div class="viewcode-block" id="get_uv_edgesRT"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_uv_edgesRT">[docs]</a><span class="k">def</span> <span class="nf">get_uv_edgesRT</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">dfRT</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dfRT</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>
    <span class="n">u</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">])</span>
    <span class="n">v</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">])</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">edges</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span></div>

<span class="c1"># Obtención de los elemetnos u,v y los edges para los hashtags fuera de los retuits:</span>

<div class="viewcode-block" id="get_uv_HashMain"><a class="viewcode-back" href="../generate_utils.html#generate_utils.get_uv_HashMain">[docs]</a><span class="k">def</span> <span class="nf">get_uv_HashMain</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">dfMain</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dfMain</span> <span class="o">=</span> <span class="n">dfMain</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">dfEliminarRTs</span> <span class="o">=</span> <span class="n">dfMain</span><span class="p">[</span><span class="n">dfMain</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">)]</span>
    <span class="n">dfMain</span> <span class="o">=</span> <span class="n">dfMain</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">dfEliminarRTs</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">dfMain</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>
    <span class="n">u</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">])</span>
    <span class="n">listHT</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">,</span><span class="s1">&#39;CitizenScience&#39;</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">listHT</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">matchhash</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchhash</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">edges</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">stop_words</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">edges</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span></div>

<div class="viewcode-block" id="getuv_htRT"><a class="viewcode-back" href="../generate_utils.html#generate_utils.getuv_htRT">[docs]</a><span class="k">def</span> <span class="nf">getuv_htRT</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filter_hashtags</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CitizenScience&#39;</span><span class="p">,</span> <span class="s1">&#39;citizenScience&#39;</span><span class="p">,</span><span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">,</span> <span class="s1">&#39;#CitizenScience&#39;</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dfRT</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>  <span class="c1"># Se seleccionan sólo las filas con RT</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>
    <span class="n">listHT</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subset</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">listHT</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">matchhash</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">matchhash</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filter_hashtags</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">filter_edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
           <span class="n">stop</span> <span class="o">=</span> <span class="kc">False</span>
           <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">edge</span><span class="p">:</span>
               <span class="c1">#print(word, word.lower() in stop_words)</span>
                <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">stop_words</span><span class="p">:</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span>
           <span class="k">if</span> <span class="ow">not</span> <span class="n">stop</span><span class="p">:</span>
               <span class="n">filter_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">filter_edges</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">filter_edges</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">filter_edges</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span></div>


<span class="c1"># Wordcloud function for main hashtags:</span>

<div class="viewcode-block" id="wordcloudmain"><a class="viewcode-back" href="../generate_utils.html#generate_utils.wordcloudmain">[docs]</a><span class="k">def</span> <span class="nf">wordcloudmain</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
    <span class="n">hashtags</span> <span class="o">=</span><span class="p">[]</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">,</span> <span class="s1">&#39;CitizenScience&#39;</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">hashtags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashtag</span><span class="p">)</span>
    <span class="n">unique_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hashtags</span><span class="p">)</span>
    <span class="n">wordcloud</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="n">stop_words</span><span class="p">,</span>
                          <span class="n">min_font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_words</span><span class="o">=</span><span class="mi">10405</span><span class="p">,</span> <span class="n">collocations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;winter&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">unique_string</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;wc.png&quot;</span><span class="p">)</span></div>

<span class="c1"># Wordcloud for main hashtags plotted inside a logo:</span>

<div class="viewcode-block" id="transform_format"><a class="viewcode-back" href="../generate_utils.html#generate_utils.transform_format">[docs]</a><span class="k">def</span> <span class="nf">transform_format</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">255</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">val</span></div>


<div class="viewcode-block" id="wordcloud_mainhtlogo"><a class="viewcode-back" href="../generate_utils.html#generate_utils.wordcloud_mainhtlogo">[docs]</a><span class="k">def</span> <span class="nf">wordcloud_mainhtlogo</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">hashtags</span> <span class="o">=</span><span class="p">[]</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">,</span> <span class="s1">&#39;CitizenScience&#39;</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">hashtags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashtag</span><span class="p">)</span>
    <span class="n">unique_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hashtags</span><span class="p">)</span>
    <span class="n">logo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
    <span class="n">transformed_logo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">((</span><span class="n">logo</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">logo</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">logo</span><span class="p">)):</span>
        <span class="n">transformed_logo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">transform_format</span><span class="p">,</span> <span class="n">logo</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="n">wc</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>
                <span class="n">background_color</span> <span class="o">=</span><span class="s1">&#39;ghostwhite&#39;</span><span class="p">,</span>
                <span class="n">stopwords</span> <span class="o">=</span> <span class="n">stop_words</span><span class="p">,</span>
                <span class="n">min_font_size</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">max_font_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">max_words</span><span class="o">=</span><span class="mi">10405</span><span class="p">,</span> <span class="n">collocations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">transformed_logo</span><span class="p">,</span>
          <span class="n">contour_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">contour_color</span><span class="o">=</span><span class="s1">&#39;cornflowerblue&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;summer&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">unique_string</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wc</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<span class="c1"># Wordlcoud for hashtags in the RTs:</span>

<div class="viewcode-block" id="wordcloudRT"><a class="viewcode-back" href="../generate_utils.html#generate_utils.wordcloudRT">[docs]</a><span class="k">def</span> <span class="nf">wordcloudRT</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
    <span class="n">hashtags</span> <span class="o">=</span><span class="p">[]</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">,</span> <span class="s1">&#39;CitizenScience&#39;</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">hashtags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashtag</span><span class="p">)</span>
    <span class="n">unique_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hashtags</span><span class="p">)</span>
    <span class="n">wordcloud</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="n">stop_words</span><span class="p">,</span>
                          <span class="n">min_font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_words</span><span class="o">=</span><span class="mi">10405</span><span class="p">,</span> <span class="n">collocations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;winter&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">unique_string</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="wordcloudRT_logo"><a class="viewcode-back" href="../generate_utils.html#generate_utils.wordcloudRT_logo">[docs]</a><span class="k">def</span> <span class="nf">wordcloudRT_logo</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">hashtags</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stop_words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;citizenscience&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">,</span> <span class="s1">&#39;citsci&#39;</span><span class="p">,</span> <span class="s1">&#39;cienciaciudadana&#39;</span><span class="p">,</span> <span class="s1">&#39;CitizenScience&#39;</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">]]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;#(\w+)&#39;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">hashtags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashtag</span><span class="p">)</span>
    <span class="n">unique_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hashtags</span><span class="p">)</span>

    <span class="n">logo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
    <span class="n">transformed_logo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">((</span><span class="n">logo</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">logo</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">logo</span><span class="p">)):</span>
        <span class="n">transformed_logo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">transform_format</span><span class="p">,</span> <span class="n">logo</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="n">wc</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
                   <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;ghostwhite&#39;</span><span class="p">,</span>
                   <span class="n">stopwords</span><span class="o">=</span><span class="n">stop_words</span><span class="p">,</span>
                   <span class="n">min_font_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_font_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">max_words</span><span class="o">=</span><span class="mi">10405</span><span class="p">,</span> <span class="n">collocations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">transformed_logo</span><span class="p">,</span>
                   <span class="n">contour_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">contour_color</span><span class="o">=</span><span class="s1">&#39;cornflowerblue&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;summer&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
        <span class="n">unique_string</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wc</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<span class="c1"># Cálculo de las palabras más usadas:</span>
<span class="c1"># La función emplea la columna texto y podemos añadir un número n que indica cuantas palabras</span>

<div class="viewcode-block" id="most_common"><a class="viewcode-back" href="../generate_utils.html#generate_utils.most_common">[docs]</a><span class="k">def</span> <span class="nf">most_common</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">number</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="c1"># Definimos stopwords en varios idiomas y símbolos que queremos eliminar del resultado</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;spanish&#39;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">STOPWORDS</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;german&#39;</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span>
    <span class="n">new_elements</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;¿&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;that?s&#39;</span><span class="p">,</span> <span class="s1">&#39;??&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;???&#39;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_elements</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="c1"># Calculamos la frecuencia de las palabras</span>
    <span class="n">word_freq</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">word_freq</span><span class="p">[</span><span class="n">word</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">word_freq</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="n">number</span><span class="p">)</span></div>

<span class="c1"># Top palabras más usadas en wordcloud:</span>

<div class="viewcode-block" id="most_commonwc"><a class="viewcode-back" href="../generate_utils.html#generate_utils.most_commonwc">[docs]</a><span class="k">def</span> <span class="nf">most_commonwc</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;spanish&#39;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">STOPWORDS</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;german&#39;</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span>
    <span class="n">new_elements</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;¿&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;that?s&#39;</span><span class="p">,</span> <span class="s1">&#39;??&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_elements</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">stopset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">word_freq</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">word_freq</span><span class="p">[</span><span class="n">word</span><span class="p">]</span>
    <span class="n">wordcloud</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="n">stopset</span><span class="p">,</span>
                          <span class="n">min_font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_words</span><span class="o">=</span><span class="mi">10405</span><span class="p">,</span> <span class="n">collocations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;winter&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">generate_from_frequencies</span><span class="p">(</span><span class="n">word_freq</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wordcloud</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<span class="c1"># Gráficos temporales</span>
<span class="c1"># Función para seleccionar Usuario,Texto y Fecha en el df y eliminar RTs:</span>

<div class="viewcode-block" id="Maindf"><a class="viewcode-back" href="../generate_utils.html#generate_utils.Maindf">[docs]</a><span class="k">def</span> <span class="nf">Maindf</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">dfMain</span><span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">,</span> <span class="s1">&#39;Fecha&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dfMain</span> <span class="o">=</span> <span class="n">dfMain</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">dfEliminarRTs</span> <span class="o">=</span> <span class="n">dfMain</span><span class="p">[</span><span class="n">dfMain</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">)]</span>
    <span class="n">dfMain</span> <span class="o">=</span> <span class="n">dfMain</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">dfEliminarRTs</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">dfMain</span> <span class="o">=</span> <span class="n">dfMain</span><span class="p">[</span><span class="n">dfMain</span><span class="p">[</span><span class="s1">&#39;Fecha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;[0-9][0-9]/[0-9][0-9]/[0-9][0-9][0-9][0-9]\s[0-9]&#39;</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">dfMain</span></div>

<span class="c1"># Función para seleccionar Usuario, Texto y Fecha en los RTs:</span>

<div class="viewcode-block" id="dfRT"><a class="viewcode-back" href="../generate_utils.html#generate_utils.dfRT">[docs]</a><span class="k">def</span> <span class="nf">dfRT</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">dfRT</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;Texto&#39;</span><span class="p">,</span> <span class="s1">&#39;Fecha&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dfRT</span> <span class="o">=</span> <span class="n">dfRT</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">dfRT</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[</span><span class="n">dfRT</span><span class="p">[</span><span class="s1">&#39;Fecha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;[0-9][0-9]/[0-9][0-9]/[0-9][0-9][0-9][0-9]\s[0-9]&#39;</span><span class="p">)]</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;RT @&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dfRT</span> <span class="o">=</span> <span class="n">dfRT</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">dfRT</span></div>

<span class="c1">#Función para extraer los días:</span>
<div class="viewcode-block" id="getDays"><a class="viewcode-back" href="../generate_utils.html#generate_utils.getDays">[docs]</a><span class="k">def</span> <span class="nf">getDays</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Fecha&#39;</span><span class="p">]</span>
    <span class="n">days</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">days</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">days</span></div>

<span class="c1"># Función para graficar uso de hashtags en el tiempo:</span>

<div class="viewcode-block" id="plottemporalserie"><a class="viewcode-back" href="../generate_utils.html#generate_utils.plottemporalserie">[docs]</a><span class="k">def</span> <span class="nf">plottemporalserie</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">numHashtag</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
        <span class="n">numPerDay</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">days</span><span class="p">:</span>
            <span class="n">dfOneDay</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Fecha&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">day</span><span class="p">]</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">dfOneDay</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">hashtag</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">numPerDay</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="n">numHashtag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numPerDay</span><span class="p">)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">reset_orig</span><span class="p">()</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="n">colours</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;magenta&quot;</span><span class="p">]</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot_date</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">numHashtag</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">colours</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">hashtag</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Se fija el titulo y etiquetas</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Número de veces&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="sentiment_analyser"><a class="viewcode-back" href="../generate_utils.html#generate_utils.sentiment_analyser">[docs]</a><span class="k">def</span> <span class="nf">sentiment_analyser</span><span class="p">(</span><span class="n">df_entry</span><span class="p">,</span><span class="n">keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keywords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stopwords2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interest</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">analyser</span> <span class="o">=</span> <span class="n">SentimentIntensityAnalyzer</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_interest</span><span class="p">(</span><span class="n">df_entry</span><span class="p">,</span> <span class="n">interest</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">filter_by_topic</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Texto&#39;</span><span class="p">,</span> <span class="s1">&#39;Usuario&#39;</span><span class="p">]]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">Users</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">]</span>
    <span class="n">Texto</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span>
    <span class="n">sentences</span> <span class="o">=</span> <span class="n">Texto</span>
    <span class="n">list_of_dicts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">:</span>
        <span class="n">adict</span> <span class="o">=</span> <span class="n">analyser</span><span class="o">.</span><span class="n">polarity_scores</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">adict</span><span class="p">)</span>
        <span class="n">list_of_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adict</span><span class="p">)</span>
    <span class="n">df_sentiment</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">list_of_dicts</span><span class="p">)</span>
    <span class="n">df_sentiment</span><span class="p">[</span><span class="s1">&#39;Usuario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Users</span>
    <span class="n">df_sentiment</span><span class="p">[</span><span class="s1">&#39;Texto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Texto</span>
    <span class="k">return</span> <span class="n">df_sentiment</span></div>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">CSTrack</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../berttopic_utils.html">berttopic_utils module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../communities_utils.html">communities_utils module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dash_cs.html">dash_cs module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dash_utils.html">dash_utils module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../generate_utils.html">generate_utils module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../map_utils.html">map_utils module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../style.html">style module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../submenus.html">submenus module</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, David Roldan and Fernando Martinez.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>